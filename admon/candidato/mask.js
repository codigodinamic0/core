/// <reference path="../../../lib/jquery-1.2.6.js" />
/*
	Masked Input plugin for jQuery
	Copyright (c) 2007-2009 Josh Bush (digitalbush.com)
	Licensed under the MIT license (http://digitalbush.com/projects/masked-input-plugin/#license) 
	Version: 1.2.2 (03/09/2009 22:39:06)
*/
// Modified by ramiro at conductiva.com to accept placeholder for the full mask
(function($){var w=($.browser.msie?'paste':'input')+".mask";var x=(window.orientation!=undefined);$.mask={definitions:{'9':"[0-9]",'a':"[A-Za-z]",'*':"[A-Za-z0-9]"}};$.fn.extend({caret:function(b,c){if(this.length==0)return;if(typeof b=='number'){c=(typeof c=='number')?c:b;return this.each(function(){if(this.setSelectionRange){this.focus();this.setSelectionRange(b,c)}else if(this.createTextRange){var a=this.createTextRange();a.collapse(true);a.moveEnd('character',c);a.moveStart('character',b);a.select()}})}else{if(this[0].setSelectionRange){b=this[0].selectionStart;c=this[0].selectionEnd}else if(document.selection&&document.selection.createRange){var d=document.selection.createRange();b=0-d.duplicate().moveStart('character',-100000);c=b+d.text.length}return{begin:b,end:c}}},unmask:function(){return this.trigger("unmask")},mask:function(m,n){if(!m&&this.length>0){var o=$(this[0]);var q=o.data("tests");return $.map(o.data("buffer"),function(c,i){return q[i]?c:null}).join('')}n=$.extend({placeholder:"_",completed:null},n);var r=$.mask.definitions;var q=[];var s=m.length;var u=null;var v=m.length;$.each(m.split(""),function(i,c){if(c=='?'){v--;s=i}else if(r[c]){q.push(new RegExp(r[c]));if(u==null)u=q.length-1}else{q.push(null)}});return this.each(function(){var f=$(this);var g=$.map(m.split(""),function(c,i){if(c!='?'){return r[c]?(n.placeholder.length>1?n.placeholder.charAt(i):n.placeholder):c}});var h=false;var l=f.val();f.data("buffer",g).data("tests",q);function seekNext(a){while(++a<=v&&!q[a]);return a};function shiftL(a){while(!q[a]&&--a>=0);for(var i=a;i<v;i++){if(q[i]){g[i]=n.placeholder.length>1?n.placeholder.charAt(i):n.placeholder;var j=seekNext(i);if(j<v&&q[i].test(g[j])){g[i]=g[j]}else break}}writeBuffer();f.caret(Math.max(u,a))};function shiftR(a){for(var i=a;i<v;i++){var c=n.placeholder.length>1?n.placeholder.charAt(i):n.placeholder;if(q[i]){var j=seekNext(i);var t=g[i];g[i]=c;if(j<v&&q[j].test(t))c=t;else break}}};function keydownEvent(e){var a=$(this).caret();var k=e.keyCode;h=(k<16||(k>16&&k<32)||(k>32&&k<41));if((a.begin-a.end)!=0&&(!h||k==8||k==46))clearBuffer(a.begin,a.end);if(k==8||k==46||(x&&k==127)){shiftL(a.begin+(k==46?0:-1));return false}else if(k==27){f.val(l);f.caret(0,checkVal());return false}};function keypressEvent(e){if(h){h=false;return(e.keyCode==8)?false:null}e=e||window.event;var k=e.charCode||e.keyCode||e.which;var a=$(this).caret();if(e.ctrlKey||e.altKey||e.metaKey){return true}else if((k>=32&&k<=125)||k>186){var p=seekNext(a.begin-1);if(p<v){var c=String.fromCharCode(k);if(q[p].test(c)){shiftR(p);g[p]=c;writeBuffer();var b=seekNext(p);$(this).caret(b);if(n.completed&&b==v)n.completed.call(f)}}}return false};function clearBuffer(a,b){for(var i=a;i<b&&i<v;i++){if(q[i])g[i]=n.placeholder.length>1?n.placeholder.charAt(i):n.placeholder}};function writeBuffer(){return f.val(g.join('')).val()};function checkVal(a){var b=f.val();var d=-1;for(var i=0,pos=0;i<v;i++){if(q[i]){g[i]=n.placeholder.length>1?n.placeholder.charAt(i):n.placeholder;while(pos++<b.length){var c=b.charAt(pos-1);if(q[i].test(c)){g[i]=c;d=i;break}}if(pos>b.length)break}else if(g[i]==b[pos]&&i!=s){pos++;d=i}}if(!a&&d+1<s){f.val("");clearBuffer(0,v)}else if(a||d+1>=s){writeBuffer();if(!a)f.val(f.val().substring(0,d+1))}return(s?i:u)};if(!f.attr("readonly"))f.one("unmask",function(){f.unbind(".mask").removeData("buffer").removeData("tests")}).bind("focus.mask",function(){l=f.val();var a=checkVal();writeBuffer();setTimeout(function(){if(a==m.length)f.caret(0,a);else f.caret(a)},0)}).bind("blur.mask",function(){checkVal();if(f.val()!=l)f.change()}).bind("keydown.mask",keydownEvent).bind("keypress.mask",keypressEvent).bind(w,function(){setTimeout(function(){f.caret(checkVal(true))},0)});checkVal()})}})})(jQuery);


